create database sqlFunction;
use sqlFunction;

-- Create Department Table
CREATE TABLE departments (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(50)
);

-- Create Employees Table
CREATE TABLE employees (
    emp_id INT PRIMARY KEY,
    emp_name VARCHAR(50),
    salary DECIMAL(10,2),
    hire_date DATE,
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
);

-- Sample Data
INSERT INTO departments VALUES 
(1, 'HR'),
(2, 'Finance'),
(3, 'IT');

INSERT INTO employees VALUES
(101, 'Alice', 45000, '2018-05-10', 1),
(102, 'Bob',   60000, '2015-03-15', 2),
(103, 'Charlie', 30000, '2020-07-20', 3),
(104, 'David', 80000, '2012-01-05', 2);


-- 1.Function: Get Annual Salary

DELIMITER //
CREATE FUNCTION get_annual_salary(p_emp_id INT)
RETURNS DECIMAL(12,2)
DETERMINISTIC
BEGIN
    DECLARE v_salary DECIMAL(10,2);
    SELECT salary INTO v_salary 
    FROM employees 
    WHERE emp_id = p_emp_id;
    RETURN v_salary * 12;
END //
DELIMITER ;
SELECT get_annual_salary(101);


-- 2.Function: Get Experience (in years)

DELIMITER //
CREATE FUNCTION get_experience(p_emp_id INT)
RETURNS INT
DETERMINISTIC
BEGIN
    DECLARE v_hire_date DATE;
    DECLARE v_years INT;
    SELECT hire_date INTO v_hire_date
    FROM employees 
    WHERE emp_id = p_emp_id;
    
    SET v_years = TIMESTAMPDIFF(YEAR, v_hire_date, CURDATE());
    RETURN v_years;
END //
DELIMITER ;

SELECT get_experience(102);


-- 3. Function: Get Department Name by Employee ID

DELIMITER //
CREATE FUNCTION get_department_name(p_emp_id INT)
RETURNS VARCHAR(50)
DETERMINISTIC
BEGIN
    DECLARE v_dept_name VARCHAR(50);
    SELECT d.dept_name INTO v_dept_name
    FROM employees e 
    JOIN departments d ON e.dept_id = d.dept_id
    WHERE e.emp_id = p_emp_id;
    RETURN v_dept_name;
END //
DELIMITER ;
SELECT get_department_name(103);


-- 4. Function: Get Number of Employees in a Department
DELIMITER //
CREATE FUNCTION get_employee_count(p_dept_id INT)
RETURNS INT
DETERMINISTIC
BEGIN
    DECLARE v_count INT;
    SELECT COUNT(*) INTO v_count
    FROM employees 
    WHERE dept_id = p_dept_id;
    RETURN v_count;
END //
DELIMITER ;
SELECT get_employee_count(2);


-- 5. Function: Get Bonus Amount

DELIMITER //
CREATE FUNCTION get_bonus(p_emp_id INT)
RETURNS DECIMAL(10,2)
DETERMINISTIC
BEGIN
    DECLARE v_salary DECIMAL(10,2);
    DECLARE v_bonus DECIMAL(10,2);
    
    SELECT salary INTO v_salary
    FROM employees 
    WHERE emp_id = p_emp_id;
    
    IF v_salary < 50000 THEN
        SET v_bonus = v_salary * 0.10;
    ELSE
        SET v_bonus = v_salary * 0.05;
    END IF;
    
    RETURN v_bonus;
END //
DELIMITER ;

SELECT get_bonus(101);














